# 変更履歴

## [3.2] - 2025-12-10

### 修正
- **PowerPoint変換エラーの解消**
  - `Application.Visible`プロパティ設定エラーを修正
  - `WithWindow=False`パラメータのみで対応し、環境依存の問題を解決
  - Word/Excel変換でも同様のエラーハンドリングを追加（堅牢性向上）
- **一太郎接続エラーの修正**
  - ウィンドウタイトル検索パターンを修正（`".*一太郎.*"` → ファイル名ベース）
  - 一太郎のウィンドウタイトルが `[ファイル名].jtd` 形式である問題に対応
  - 待機時間を5秒に延長（実際の起動時間に合わせて調整）
  - 正規表現の特殊文字を `re.escape()` で適切にエスケープ
  - デバッグログを追加してウィンドウ検索パターンを表示
  - より確実で環境非依存な接続を実現
- **一太郎ファイル名入力の改善**
  - 「印刷結果を名前を付けて保存」ダイアログを直接制御
  - **4段階のフォールバック機能**で確実に入力
    1. ComboBox内のEditコントロール（推奨方法）
    2. auto_id="1148"のEditコントロール
    3. pywinauto.keyboard.send_keysによるキーボード入力
    4. 従来のsend_keysによる代替入力
  - ダイアログのタイトルで確実に検出（`".*名前.*保存.*"`パターン）
  - 詳細なデバッグログで各方法の成功/失敗を記録
  - `print_control_identifiers()`でダイアログ構造を診断
  - 印刷実行後の待機時間を3秒→1秒に短縮（高速化）
  - ファイル名入力の確実性が大幅に向上

### 追加
- **一太郎変換のカスタマイズ強化**
  - `down_arrow_count`設定を追加（デフォルト: 5回）
  - **設定タブのUIで下矢印回数を直接変更可能**
  - プリンタの並び順が変わった場合も簡単に調整できる
  - わかりやすい説明とヒントを表示
  - config.jsonで下矢印キー押下回数をカスタマイズ可能に
  - プリンタ選択の柔軟性を向上
- **ログファイルへのアクセス改善**
  - 設定画面に「📄 ログファイルを開く」ボタンを追加
  - ワンクリックでログファイルを開けるように改善
  - デバッグ情報の確認が容易に

### 改善

- **一太郎変換の単純化とリトライ改善**
  - GUI自動化コードを大幅に単純化
  - 一時ファイル検出方式の問題を解決し、シンプルな時間ベース待機に変更
  - 環境非依存で確実に動作する実装に改善
  - 不要な`_wait_for_ichitaro_ready`メソッドを削除
  - 3秒待機 + pywinauto接続のシンプルなフロー
  - コードの可読性と保守性が向上
- **設定の整理**
  - 一太郎設定を4項目に集約：`ichitaro_ready_timeout`、`max_retries`、`down_arrow_count`、`save_wait_seconds`
  - 未使用の設定項目（`open_wait_seconds`、`dialog_wait_seconds`など）を削除
- **ログ出力の強化**
  - PowerPoint起動時に`WithWindow=False`使用を明示
  - Office変換時の詳細なデバッグ情報を追加
  - 一太郎接続時の2段階待機状態を明確に表示
- **テストの拡充**
  - `down_arrow_count`設定のテストケースを追加
  - デフォルト設定とカスタム設定の両方を検証
  - 新しい設定項目に対応したテストに更新

### 技術的な改善
- COMオブジェクトのエラーハンドリングを強化
- Office変換の信頼性を向上
- コードの保守性を大幅に改善
- 一太郎変換の信頼性向上（環境依存問題の解消）
- 高速環境での待機時間短縮、低速環境での確実な起動検出

---

## [3.1] - 以前のバージョン

### 機能
- PDF統合機能の実装
- Office文書（Word、Excel、PowerPoint）からPDF変換
- 一太郎文書からPDF変換
- 画像ファイルからPDF変換
- 区切りページ（中扉）の自動生成
- キャンセル機能の実装
- 設定の永続化

### UI
- タブベースのGUI実装
- リアルタイムログ表示
- プログレスバー表示
- ドラッグ&ドロップ対応

### システム
- Ghostscript自動検出
- 設定ファイル管理
- エラーハンドリング
- 一時ファイル管理
